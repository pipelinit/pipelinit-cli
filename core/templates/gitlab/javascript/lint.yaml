<% if (it.runtime.name === "deno") { -%>
lint:
  stage: deno-lint
  image: denoland/setup-deno@v1
  needs: []
  script:
    - deno lint --unstable
  only:
    refs:
      - merge_requests
    changes:
      - "**/*.js"
      - "**/*.ts"
<% } else if (it.runtime.name === "node" && it.linters) { -%>
lint:
  stage: javascript-lint
  image: actions/setup-node@v2
  needs: []
  script:
    - <%= it.packageManager.commands.install %>
<%_ if (it.formatters.eslint) { %>
    - npx eslint --ext .js --ext .ts .
<% } -%>
  cache:
    key: '<%= it.packageManager.name %>'
  only:
    refs:
      - merge_requests
    changes:
      - "**/*.js"
      - "**/*.ts"
<% } -%>
<% if (it.hasTypeScriptFiles) { -%>
  tsc:
    stage: typecheck-typescript
<% if (it.runtime.name === "deno") { -%>
  image: denoland/setup-deno@v1
  needs: []
  script:
    - deno cache --unstable $(find . -iname "*.ts")
<% } else if (it.runtime.name === "node") { -%>
  image: actions/setup-node@v2
  needs: []
  cache:
    key: '<%= it.packageManager.name %>'
  script:
    - <%= it.packageManager.commands.install %>
    - NPM_CONFIG_YES=true npx -p typescript -c 'tsc --init && tsc --noEmit'
<% } -%>
<% } -%>
